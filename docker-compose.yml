services:
  converter:
    build: .
    container_name: md-converter
    ports:
      - "8501:8501"
    environment:
      - STREAMLIT_BROWSER_GATHER_USAGE_STATS=false
      - PYTHONUNBUFFERED=1
      - TORCH_DEVICE=cpu         # Marker/Docling nutzen Torch -> CPU-only in Docker
    volumes:
      - ./data/in:/app/data/in
      - ./data/out:/app/data/out
      - ./data/cache:/app/.cache
    command: streamlit run /app/app.py --server.port 8501 --server.address 0.0.0.0
    # FÃ¼r Apple Silicon optional:
    # platform: linux/arm64
    healthcheck:
      test: ["CMD-SHELL", "python -c \"import urllib.request,sys; sys.exit(0) if urllib.request.urlopen('http://0.0.0.1:8501').status==200 else sys.exit(1)\""]
      interval: 30s
      timeout: 5s
      retries: 5
      start_period: 20s